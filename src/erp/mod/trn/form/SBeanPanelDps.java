/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package erp.mod.trn.form;

import erp.gui.session.SSessionCustom;
import erp.mod.SModConsts;
import erp.mod.bps.db.SBpsUtils;
import erp.mod.fin.db.SFinBalance;
import erp.mod.fin.db.SFinUtils;
import erp.mod.trn.db.SDbDps;
import erp.mod.trn.db.STrnUtils;
import java.util.Date;
import javax.swing.JPanel;
import javax.swing.JTextField;
import sa.gui.util.SUtilConsts;
import sa.lib.SLibConsts;
import sa.lib.SLibUtils;
import sa.lib.db.SDbRegistry;
import sa.lib.gui.SGuiClient;
import sa.lib.gui.SGuiConsts;
import sa.lib.gui.SGuiUtils;

/**
 *
 * @author Sergio Flores
 */
public class SBeanPanelDps extends JPanel {

    private SGuiClient miClient;
    private SDbDps moDps;
    private Date mtDateCutOff;

    /**
     * Creates new form SBeanPanelDps
     */
    public SBeanPanelDps() {
        initComponents();
        initComponentsCustom();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel8 = new javax.swing.JPanel();
        jPanel3 = new javax.swing.JPanel();
        jPanel1 = new javax.swing.JPanel();
        jPanel2 = new javax.swing.JPanel();
        jlBizPartner = new javax.swing.JLabel();
        jtfBizPartner = new javax.swing.JTextField();
        jPanel6 = new javax.swing.JPanel();
        jlBizPartnerBranch = new javax.swing.JLabel();
        jtfBizPartnerBranch = new javax.swing.JTextField();
        jPanel7 = new javax.swing.JPanel();
        jlNumber = new javax.swing.JLabel();
        jtfNumber = new javax.swing.JTextField();
        jtfNumberReference = new javax.swing.JTextField();
        jPanel9 = new javax.swing.JPanel();
        jlDate = new javax.swing.JLabel();
        jtfDate = new javax.swing.JTextField();
        jPanel4 = new javax.swing.JPanel();
        jPanel11 = new javax.swing.JPanel();
        jlCurrency = new javax.swing.JLabel();
        jtfCurrency = new javax.swing.JTextField();
        jPanel5 = new javax.swing.JPanel();
        jlTotal = new javax.swing.JLabel();
        moCurTotalCy = new sa.lib.gui.bean.SBeanCompoundFieldCurrency();
        moCurTotal = new sa.lib.gui.bean.SBeanCompoundFieldCurrency();
        jPanel12 = new javax.swing.JPanel();
        jlDateCutOff = new javax.swing.JLabel();
        jtfDateCutOff = new javax.swing.JTextField();
        jPanel10 = new javax.swing.JPanel();
        jlBalance = new javax.swing.JLabel();
        moCurBalanceCy = new sa.lib.gui.bean.SBeanCompoundFieldCurrency();
        moCurBalance = new sa.lib.gui.bean.SBeanCompoundFieldCurrency();

        setLayout(new java.awt.BorderLayout());

        jPanel8.setLayout(new java.awt.BorderLayout());

        jPanel3.setLayout(new java.awt.BorderLayout());

        jPanel1.setLayout(new java.awt.GridLayout(4, 1, 0, 5));

        jPanel2.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlBizPartner.setText("Asociado negocios:");
        jlBizPartner.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanel2.add(jlBizPartner);

        jtfBizPartner.setEditable(false);
        jtfBizPartner.setFocusable(false);
        jtfBizPartner.setPreferredSize(new java.awt.Dimension(205, 23));
        jPanel2.add(jtfBizPartner);

        jPanel1.add(jPanel2);

        jPanel6.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlBizPartnerBranch.setText("Sucursal:");
        jlBizPartnerBranch.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanel6.add(jlBizPartnerBranch);

        jtfBizPartnerBranch.setEditable(false);
        jtfBizPartnerBranch.setFocusable(false);
        jtfBizPartnerBranch.setPreferredSize(new java.awt.Dimension(205, 23));
        jPanel6.add(jtfBizPartnerBranch);

        jPanel1.add(jPanel6);

        jPanel7.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlNumber.setText("Folio doc.:");
        jlNumber.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanel7.add(jlNumber);

        jtfNumber.setEditable(false);
        jtfNumber.setFocusable(false);
        jtfNumber.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanel7.add(jtfNumber);

        jtfNumberReference.setEditable(false);
        jtfNumberReference.setToolTipText("Referencia");
        jtfNumberReference.setFocusable(false);
        jtfNumberReference.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanel7.add(jtfNumberReference);

        jPanel1.add(jPanel7);

        jPanel9.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlDate.setText("Fecha doc.:");
        jlDate.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanel9.add(jlDate);

        jtfDate.setEditable(false);
        jtfDate.setFocusable(false);
        jtfDate.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanel9.add(jtfDate);

        jPanel1.add(jPanel9);

        jPanel3.add(jPanel1, java.awt.BorderLayout.WEST);

        jPanel4.setLayout(new java.awt.GridLayout(4, 1, 0, 5));

        jPanel11.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlCurrency.setText("Moneda:");
        jlCurrency.setPreferredSize(new java.awt.Dimension(75, 23));
        jPanel11.add(jlCurrency);

        jtfCurrency.setEditable(false);
        jtfCurrency.setFocusable(false);
        jtfCurrency.setPreferredSize(new java.awt.Dimension(140, 23));
        jPanel11.add(jtfCurrency);

        jPanel4.add(jPanel11);

        jPanel5.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlTotal.setText("Total doc.:");
        jlTotal.setPreferredSize(new java.awt.Dimension(75, 23));
        jPanel5.add(jlTotal);

        moCurTotalCy.setEditable(false);
        moCurTotalCy.setFocusable(false);
        jPanel5.add(moCurTotalCy);

        moCurTotal.setEditable(false);
        moCurTotal.setFocusable(false);
        jPanel5.add(moCurTotal);

        jPanel4.add(jPanel5);

        jPanel12.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlDateCutOff.setText("Fecha corte:");
        jlDateCutOff.setPreferredSize(new java.awt.Dimension(75, 23));
        jPanel12.add(jlDateCutOff);

        jtfDateCutOff.setEditable(false);
        jtfDateCutOff.setFocusable(false);
        jtfDateCutOff.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanel12.add(jtfDateCutOff);

        jPanel4.add(jPanel12);

        jPanel10.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlBalance.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        jlBalance.setText("Saldo doc.:");
        jlBalance.setPreferredSize(new java.awt.Dimension(75, 23));
        jPanel10.add(jlBalance);

        moCurBalanceCy.setEditable(false);
        moCurBalanceCy.setFocusable(false);
        jPanel10.add(moCurBalanceCy);

        moCurBalance.setEditable(false);
        moCurBalance.setFocusable(false);
        jPanel10.add(moCurBalance);

        jPanel4.add(jPanel10);

        jPanel3.add(jPanel4, java.awt.BorderLayout.CENTER);

        jPanel8.add(jPanel3, java.awt.BorderLayout.NORTH);

        add(jPanel8, java.awt.BorderLayout.CENTER);
    }// </editor-fold>//GEN-END:initComponents
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel10;
    private javax.swing.JPanel jPanel11;
    private javax.swing.JPanel jPanel12;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JPanel jPanel7;
    private javax.swing.JPanel jPanel8;
    private javax.swing.JPanel jPanel9;
    private javax.swing.JLabel jlBalance;
    private javax.swing.JLabel jlBizPartner;
    private javax.swing.JLabel jlBizPartnerBranch;
    private javax.swing.JLabel jlCurrency;
    private javax.swing.JLabel jlDate;
    private javax.swing.JLabel jlDateCutOff;
    private javax.swing.JLabel jlNumber;
    private javax.swing.JLabel jlTotal;
    private javax.swing.JTextField jtfBizPartner;
    private javax.swing.JTextField jtfBizPartnerBranch;
    private javax.swing.JTextField jtfCurrency;
    private javax.swing.JTextField jtfDate;
    private javax.swing.JTextField jtfDateCutOff;
    private javax.swing.JTextField jtfNumber;
    private javax.swing.JTextField jtfNumberReference;
    private sa.lib.gui.bean.SBeanCompoundFieldCurrency moCurBalance;
    private sa.lib.gui.bean.SBeanCompoundFieldCurrency moCurBalanceCy;
    private sa.lib.gui.bean.SBeanCompoundFieldCurrency moCurTotal;
    private sa.lib.gui.bean.SBeanCompoundFieldCurrency moCurTotalCy;
    // End of variables declaration//GEN-END:variables

    /*
     * Private methods
     */

    private void initComponentsCustom() {
        moCurTotalCy.getField().setDecimalSettings(SGuiUtils.getLabelName(jlTotal), SGuiConsts.GUI_TYPE_DEC_AMT, false);
        moCurTotal.getField().setDecimalSettings(SGuiUtils.getLabelName(jlTotal), SGuiConsts.GUI_TYPE_DEC_AMT, false);
        moCurBalanceCy.getField().setDecimalSettings(SGuiUtils.getLabelName(jlBalance), SGuiConsts.GUI_TYPE_DEC_AMT, false);
        moCurBalance.getField().setDecimalSettings(SGuiUtils.getLabelName(jlBalance), SGuiConsts.GUI_TYPE_DEC_AMT, false);
    }

    /*
     * Public methods
     */

    public void setPanelSettings(final SGuiClient client) {
        miClient = client;
        moCurTotalCy.setCompoundFieldSettings(client);
        moCurTotal.setCompoundFieldSettings(client);
        moCurBalanceCy.setCompoundFieldSettings(client);
        moCurBalance.setCompoundFieldSettings(client);
    }

    public void resetPanel() {
        setDps(null, null, null);
    }

    public void setDps(final SDbDps dps, final Date dateCutOff, final Object[] keyRecordToExclude_n) {
        int idBizPartnerCategory = SLibConsts.UNDEFINED;
        int[] keyCurrency = null;
        SFinBalance balance = null;
        SSessionCustom sessionCustom = null;

        moDps = dps;
        mtDateCutOff = dateCutOff;

        if (moDps == null) {
            jlBizPartner.setText(SUtilConsts.TXT_COMPANY + ":");
            jlBizPartnerBranch.setText(SUtilConsts.TXT_BRANCH + ":");

            jtfBizPartner.setText("");
            jtfBizPartnerBranch.setText("");
            jtfNumber.setText("");
            jtfNumberReference.setText("");
            jtfDate.setText("");
            jtfCurrency.setText("");
            jtfDateCutOff.setText("");
            moCurTotalCy.setCurrencyKey(null);
            moCurBalanceCy.setCurrencyKey(null);
            ((JTextField) moCurTotalCy.getField().getComponent()).setText("");
            ((JTextField) moCurTotal.getField().getComponent()).setText("");
            ((JTextField) moCurBalanceCy.getField().getComponent()).setText("");
            ((JTextField) moCurBalance.getField().getComponent()).setText("");
        }
        else {
            idBizPartnerCategory = STrnUtils.getBizPartnerCategoryId(moDps.getFkDpsCategoryId());
            keyCurrency = new int[] { moDps.getFkCurrencyId() };
            balance = SFinUtils.getDpsBalance(miClient.getSession(), (int[]) moDps.getPrimaryKey(), dateCutOff, keyRecordToExclude_n);
            sessionCustom = (SSessionCustom) miClient.getSession().getSessionCustom();

            jlBizPartner.setText(SBpsUtils.getBizPartnerCategoryName(idBizPartnerCategory, SUtilConsts.NUM_SNG) + ":");
            jlBizPartnerBranch.setText(SUtilConsts.TXT_BRANCH + " " + SBpsUtils.getBizPartnerCategoryName(idBizPartnerCategory, SUtilConsts.NUM_SNG).toLowerCase() + ":");

            jtfBizPartner.setText((String) miClient.getSession().readField(SModConsts.BPSU_BP, new int[] { moDps.getFkBizPartnerId_r() }, SDbRegistry.FIELD_NAME));
            jtfBizPartnerBranch.setText((String) miClient.getSession().readField(SModConsts.BPSU_BPB, new int[] { moDps.getFkBizPartnerBranchId() }, SDbRegistry.FIELD_NAME));
            jtfNumber.setText(moDps.getDpsNumber());
            jtfNumberReference.setText(moDps.getNumberReference());
            jtfDate.setText(SLibUtils.DateFormatDate.format(moDps.getDate()));
            jtfCurrency.setText(sessionCustom.getCurrency(keyCurrency));
            jtfDateCutOff.setText(SLibUtils.DateFormatDate.format(mtDateCutOff));
            moCurTotalCy.setCurrencyKey(keyCurrency);
            moCurBalanceCy.setCurrencyKey(keyCurrency);
            moCurTotalCy.getField().setValue(moDps.getTotalCy_r());
            moCurBalanceCy.getField().setValue(balance == null ? moDps.getTotalCy_r() : balance.getBalanceCy());

            if (sessionCustom.isLocalCurrency(keyCurrency)) {
                ((JTextField) moCurTotal.getField().getComponent()).setText("");
                ((JTextField) moCurBalance.getField().getComponent()).setText("");
            }
            else {
                moCurTotal.getField().setValue(moDps.getTotal_r());
                moCurBalance.getField().setValue(balance == null ? moDps.getTotal_r() : balance.getBalance());
            }
        }

        jtfBizPartner.setCaretPosition(0);
        jtfBizPartnerBranch.setCaretPosition(0);
        jtfNumber.setCaretPosition(0);
        jtfNumberReference.setCaretPosition(0);
        jtfDate.setCaretPosition(0);
        jtfCurrency.setCaretPosition(0);
        jtfDateCutOff.setCaretPosition(0);
    }

    /*
     * Overriden methods
     */

    @Override
    public void setEnabled(boolean enabled) {
        super.setEnabled(enabled);
        jlBizPartner.setEnabled(enabled);
        jlBizPartnerBranch.setEnabled(enabled);
        jlNumber.setEnabled(enabled);
        jlDate.setEnabled(enabled);
        jlCurrency.setEnabled(enabled);
        jlTotal.setEnabled(enabled);
        jlDateCutOff.setEnabled(enabled);
        jlBalance.setEnabled(enabled);
        moCurTotalCy.setEnabled(enabled);
        moCurTotal.setEnabled(enabled);
        moCurBalanceCy.setEnabled(enabled);
        moCurBalance.setEnabled(enabled);
    }
}
