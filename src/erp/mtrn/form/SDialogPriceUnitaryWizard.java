/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * SDialogPriceUnitaryWizard.java
 *
 * Created on 8/10/2010, 09:15:43 AM
 */

package erp.mtrn.form;

import java.awt.event.KeyEvent;
import java.util.Vector;

import erp.lib.SLibConstants;
import erp.lib.form.SFormField;
import erp.lib.form.SFormUtilities;

/**
 *
 * @author Sergio Flores
 */
public class SDialogPriceUnitaryWizard extends javax.swing.JDialog {

    private erp.client.SClientInterface miClient;

    private int mnFormResult;
    private boolean mbFirstTime;
    private java.util.Vector<erp.lib.form.SFormField> mvFields;

    private erp.lib.form.SFormField moFieldQuantity;
    private erp.lib.form.SFormField moFieldSubtotal;
    private erp.lib.form.SFormField moFieldPriceUnitary;

    /** Creates new form SDialogPriceUnitaryWizard */
    public SDialogPriceUnitaryWizard(erp.client.SClientInterface client) {
        super(client.getFrame(), true);
        miClient = client;
        initComponents();
        initComponentsExtra();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel6 = new javax.swing.JPanel();
        jPanel1 = new javax.swing.JPanel();
        jPanel3 = new javax.swing.JPanel();
        jlQuantity = new javax.swing.JLabel();
        jtfQuantity = new javax.swing.JTextField();
        jtfQuantityUnitRo = new javax.swing.JTextField();
        jPanel4 = new javax.swing.JPanel();
        jlSubtotal = new javax.swing.JLabel();
        jtfSubtotal = new javax.swing.JTextField();
        jtfSubtotalCurRo = new javax.swing.JTextField();
        jPanel5 = new javax.swing.JPanel();
        jlPriceUnitary = new javax.swing.JLabel();
        jtfPriceUnitary = new javax.swing.JTextField();
        jtfPriceUnitaryCurRo = new javax.swing.JTextField();
        jbCalculate = new javax.swing.JButton();
        jPanel2 = new javax.swing.JPanel();
        jbOk = new javax.swing.JButton();
        jbCancel = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Asistente de cálculo de precio unitario");
        setModal(true);
        setResizable(false);
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowActivated(java.awt.event.WindowEvent evt) {
                formWindowActivated(evt);
            }
        });

        jPanel6.setBorder(javax.swing.BorderFactory.createTitledBorder("Cálculo de precio unitario:"));
        jPanel6.setLayout(new java.awt.BorderLayout());

        jPanel1.setLayout(new java.awt.GridLayout(3, 1, 0, 1));

        jPanel3.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 2, 0));

        jlQuantity.setText("Cantidad:");
        jlQuantity.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanel3.add(jlQuantity);

        jtfQuantity.setHorizontalAlignment(javax.swing.JTextField.TRAILING);
        jtfQuantity.setText("0.0000");
        jtfQuantity.setPreferredSize(new java.awt.Dimension(125, 23));
        jtfQuantity.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                jtfQuantityFocusLost(evt);
            }
        });
        jPanel3.add(jtfQuantity);

        jtfQuantityUnitRo.setEditable(false);
        jtfQuantityUnitRo.setText("UN");
        jtfQuantityUnitRo.setFocusable(false);
        jtfQuantityUnitRo.setPreferredSize(new java.awt.Dimension(50, 23));
        jPanel3.add(jtfQuantityUnitRo);

        jPanel1.add(jPanel3);

        jPanel4.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 2, 0));

        jlSubtotal.setText("Subtotal:");
        jlSubtotal.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanel4.add(jlSubtotal);

        jtfSubtotal.setHorizontalAlignment(javax.swing.JTextField.TRAILING);
        jtfSubtotal.setText("0.00");
        jtfSubtotal.setPreferredSize(new java.awt.Dimension(125, 23));
        jtfSubtotal.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                jtfSubtotalFocusLost(evt);
            }
        });
        jPanel4.add(jtfSubtotal);

        jtfSubtotalCurRo.setEditable(false);
        jtfSubtotalCurRo.setText("CUR");
        jtfSubtotalCurRo.setFocusable(false);
        jtfSubtotalCurRo.setPreferredSize(new java.awt.Dimension(50, 23));
        jPanel4.add(jtfSubtotalCurRo);

        jPanel1.add(jPanel4);

        jPanel5.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 2, 0));

        jlPriceUnitary.setText("Precio unitario:");
        jlPriceUnitary.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanel5.add(jlPriceUnitary);

        jtfPriceUnitary.setHorizontalAlignment(javax.swing.JTextField.TRAILING);
        jtfPriceUnitary.setText("0.0000");
        jtfPriceUnitary.setPreferredSize(new java.awt.Dimension(125, 23));
        jPanel5.add(jtfPriceUnitary);

        jtfPriceUnitaryCurRo.setEditable(false);
        jtfPriceUnitaryCurRo.setText("CUR");
        jtfPriceUnitaryCurRo.setFocusable(false);
        jtfPriceUnitaryCurRo.setPreferredSize(new java.awt.Dimension(50, 23));
        jPanel5.add(jtfPriceUnitaryCurRo);

        jbCalculate.setIcon(new javax.swing.ImageIcon(getClass().getResource("/erp/img/icon_std_action.gif"))); // NOI18N
        jbCalculate.setToolTipText("Calcular precio unitario");
        jbCalculate.setFocusable(false);
        jbCalculate.setPreferredSize(new java.awt.Dimension(23, 23));
        jbCalculate.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbCalculateActionPerformed(evt);
            }
        });
        jPanel5.add(jbCalculate);

        jPanel1.add(jPanel5);

        jPanel6.add(jPanel1, java.awt.BorderLayout.PAGE_START);

        getContentPane().add(jPanel6, java.awt.BorderLayout.CENTER);

        jPanel2.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.RIGHT));

        jbOk.setText("Aceptar");
        jbOk.setToolTipText("[Ctrl + Enter]");
        jbOk.setPreferredSize(new java.awt.Dimension(75, 23));
        jbOk.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbOkActionPerformed(evt);
            }
        });
        jPanel2.add(jbOk);

        jbCancel.setText("Cancelar");
        jbCancel.setToolTipText("[Escape]");
        jbCancel.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbCancelActionPerformed(evt);
            }
        });
        jPanel2.add(jbCancel);

        getContentPane().add(jPanel2, java.awt.BorderLayout.SOUTH);

        java.awt.Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();
        setBounds((screenSize.width-400)/2, (screenSize.height-300)/2, 400, 300);
    }// </editor-fold>//GEN-END:initComponents

    private void jtfQuantityFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jtfQuantityFocusLost
        calculatePriceUnitary();
    }//GEN-LAST:event_jtfQuantityFocusLost

    private void jtfSubtotalFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jtfSubtotalFocusLost
        calculatePriceUnitary();
    }//GEN-LAST:event_jtfSubtotalFocusLost

    private void formWindowActivated(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowActivated
        windowActivated();
    }//GEN-LAST:event_formWindowActivated

    private void jbOkActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jbOkActionPerformed
        actionOk();
    }//GEN-LAST:event_jbOkActionPerformed

    private void jbCancelActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jbCancelActionPerformed
        actionCancel();
    }//GEN-LAST:event_jbCancelActionPerformed

    private void jbCalculateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jbCalculateActionPerformed
        calculatePriceUnitary();
        jtfPriceUnitary.requestFocus();
    }//GEN-LAST:event_jbCalculateActionPerformed

    private void initComponentsExtra() {
        moFieldQuantity = new SFormField(miClient, SLibConstants.DATA_TYPE_DOUBLE, true, jtfQuantity, jlQuantity);
        moFieldQuantity.setDecimalFormat(miClient.getSessionXXX().getFormatters().getDecimalsQuantityFormat());
        moFieldSubtotal = new SFormField(miClient, SLibConstants.DATA_TYPE_DOUBLE, true, jtfSubtotal, jlSubtotal);
        moFieldSubtotal.setDecimalFormat(miClient.getSessionXXX().getFormatters().getDecimalsValueFormat());
        moFieldPriceUnitary = new SFormField(miClient, SLibConstants.DATA_TYPE_DOUBLE, true, jtfPriceUnitary, jlPriceUnitary);
        moFieldPriceUnitary.setDecimalFormat(miClient.getSessionXXX().getFormatters().getDecimalsValueUnitaryFormat());

        mvFields = new Vector<SFormField>();
        mvFields.add(moFieldQuantity);
        mvFields.add(moFieldSubtotal);
        mvFields.add(moFieldPriceUnitary);

        SFormUtilities.createActionMap(rootPane, this, "actionOk", "ok", KeyEvent.VK_ENTER, KeyEvent.CTRL_DOWN_MASK);
        SFormUtilities.createActionMap(rootPane, this, "actionCancel", "cancel", KeyEvent.VK_ESCAPE, 0);
    }

    private void windowActivated() {
        if (mbFirstTime) {
            mbFirstTime = false;
            if (jtfQuantity.isFocusable()) {
                jtfQuantity.requestFocus();
            }
            else {
                jtfSubtotal.requestFocus();
            }
        }
    }

    private void calculatePriceUnitary() {
        moFieldPriceUnitary.setFieldValue(moFieldQuantity.getDouble() == 0d ? 0d : moFieldSubtotal.getDouble() / moFieldQuantity.getDouble());
    }

    public void actionOk() {
        mnFormResult = SLibConstants.FORM_RESULT_OK;
        setVisible(false);
    }

    public void actionCancel() {
        mnFormResult = SLibConstants.FORM_RESULT_CANCEL;
        setVisible(false);
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JButton jbCalculate;
    private javax.swing.JButton jbCancel;
    private javax.swing.JButton jbOk;
    private javax.swing.JLabel jlPriceUnitary;
    private javax.swing.JLabel jlQuantity;
    private javax.swing.JLabel jlSubtotal;
    private javax.swing.JTextField jtfPriceUnitary;
    private javax.swing.JTextField jtfPriceUnitaryCurRo;
    private javax.swing.JTextField jtfQuantity;
    private javax.swing.JTextField jtfQuantityUnitRo;
    private javax.swing.JTextField jtfSubtotal;
    private javax.swing.JTextField jtfSubtotalCurRo;
    // End of variables declaration//GEN-END:variables

    public void setParams(double quantity, boolean isQuantityEditable, java.lang.String unit, java.lang.String currency) {
        mnFormResult = SLibConstants.UNDEFINED;
        mbFirstTime = true;

        moFieldQuantity.setFieldValue(quantity);
        moFieldSubtotal.setFieldValue(0d);
        moFieldPriceUnitary.setFieldValue(0d);

        jtfQuantity.setEditable(isQuantityEditable);
        jtfQuantity.setFocusable(isQuantityEditable);

        jtfQuantityUnitRo.setText(unit);
        jtfSubtotalCurRo.setText(currency);
        jtfPriceUnitaryCurRo.setText(currency);
    }

    public int getFormResult() {
        return mnFormResult;
    }

    public double getQuantity() {
        return moFieldQuantity.getDouble();
    }

    public double getPriceUnitary() {
        return moFieldPriceUnitary.getDouble();
    }
}
