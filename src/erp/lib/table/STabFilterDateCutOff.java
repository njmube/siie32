/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

package erp.lib.table;

import erp.lib.SLibConstants;

/**
 *
 * @author Sergio Flores
 */
public class STabFilterDateCutOff extends javax.swing.JPanel {

    private erp.client.SClientInterface miClient;
    private erp.lib.table.STableTabInterface miTableTab;

    private java.util.Date mtDate;
    private erp.lib.table.STableSetting moSetting;

    /** Creates new form DTabFilterDateCutOff */
    public STabFilterDateCutOff(erp.client.SClientInterface client, erp.lib.table.STableTabInterface tableTab) {
        this(client, tableTab, null);
    }

    /** Creates new form DTabFilterDateCutOff */
    public STabFilterDateCutOff(erp.client.SClientInterface client, erp.lib.table.STableTabInterface tableTab, java.util.Date dateCutOff) {
        miClient = client;
        miTableTab = tableTab;
        mtDate = dateCutOff;
        initComponents();
        initComponentsExtra();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jtfDate = new javax.swing.JTextField();
        jbDate = new javax.swing.JButton();
        jbSystemDate = new javax.swing.JButton();
        jbDateNull = new javax.swing.JButton();

        setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 3, 0));

        jtfDate.setEditable(false);
        jtfDate.setText("01/01/2000");
        jtfDate.setToolTipText("Fecha de corte");
        jtfDate.setFocusable(false);
        jtfDate.setPreferredSize(new java.awt.Dimension(65, 20));
        add(jtfDate);

        jbDate.setIcon(new javax.swing.ImageIcon(getClass().getResource("/erp/img/cal_cal.gif"))); // NOI18N
        jbDate.setToolTipText("Seleccionar fecha de corte");
        jbDate.setPreferredSize(new java.awt.Dimension(23, 23));
        jbDate.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbDateActionPerformed(evt);
            }
        });
        add(jbDate);

        jbSystemDate.setIcon(new javax.swing.ImageIcon(getClass().getResource("/erp/img/cal_date_day.gif"))); // NOI18N
        jbSystemDate.setToolTipText("Hoy");
        jbSystemDate.setPreferredSize(new java.awt.Dimension(23, 23));
        jbSystemDate.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbSystemDateActionPerformed(evt);
            }
        });
        add(jbSystemDate);

        jbDateNull.setIcon(new javax.swing.ImageIcon(getClass().getResource("/erp/img/cal_date_null.gif"))); // NOI18N
        jbDateNull.setToolTipText("Quitar fecha de corte");
        jbDateNull.setPreferredSize(new java.awt.Dimension(23, 23));
        jbDateNull.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbDateNullActionPerformed(evt);
            }
        });
        add(jbDateNull);
    }// </editor-fold>//GEN-END:initComponents

    private void jbDateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jbDateActionPerformed
        actionDate();
    }//GEN-LAST:event_jbDateActionPerformed

    private void jbSystemDateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jbSystemDateActionPerformed
        mtDate = miClient.getSessionXXX().getWorkingDate();
        moSetting.setSetting(mtDate);
        miTableTab.updateSetting(moSetting);
        renderDate();
}//GEN-LAST:event_jbSystemDateActionPerformed

    private void jbDateNullActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jbDateNullActionPerformed
        mtDate = null;
        moSetting.setSetting(mtDate);
        miTableTab.updateSetting(moSetting);
        renderDate();
    }//GEN-LAST:event_jbDateNullActionPerformed

    private void initComponentsExtra() {
        moSetting = null;

        mtDate = null;  // The date is null because the user need to see all the documents at the beginning
        moSetting = new STableSetting(STableConstants.SETTING_FILTER_PERIOD, mtDate);
        miTableTab.addSetting(moSetting);
        renderDate();
    }

    private void renderDate() {
        if (mtDate == null) {
            jtfDate.setText("âˆž");
        }
        else {
            jtfDate.setText(miClient.getSessionXXX().getFormatters().getDateFormat().format(mtDate));
        }
    }

    private void actionDate() {
        if (mtDate == null) {
            mtDate = miClient.getSessionXXX().getWorkingDate();
        }

        miClient.getGuiDatePickerXXX().formReset();
        miClient.getGuiDatePickerXXX().setDate(mtDate);
        miClient.getGuiDatePickerXXX().setVisible(true);

        if (miClient.getGuiDatePickerXXX().getFormResult() == SLibConstants.FORM_RESULT_OK) {
            mtDate = miClient.getGuiDatePickerXXX().getGuiDate();
            moSetting.setSetting(mtDate);
            miTableTab.updateSetting(moSetting);
            renderDate();
        }
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jbDate;
    private javax.swing.JButton jbDateNull;
    private javax.swing.JButton jbSystemDate;
    private javax.swing.JTextField jtfDate;
    // End of variables declaration//GEN-END:variables
}
